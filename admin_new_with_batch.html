<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¾Œå°ç®¡ç†ç³»çµ±</title>
<style>
  body { font-family: 'Microsoft JhengHei', sans-serif; max-width: 1000px; margin: auto; padding: 20px; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  tr:nth-child(even) { background-color: #f2f2f2; }
  input[type=text], input[type=number] { width: 95%; padding: 5px; }
  button { padding: 6px 10px; margin: 2px; cursor: pointer; }
  .add-form { background: #eef; padding: 10px; margin-bottom: 10px; }
  .download-btn { background: green; color: white; padding: 10px; margin-top: 10px; }
  .upload-section { background: #f1f1f1; padding: 10px; margin-top: 20px; border-radius: 6px; }
</style>
</head>
<body>
<h1>ğŸ’Š å¾Œå°ç®¡ç†ç³»çµ±</h1>
<p>å¯æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€æ‰¹æ¬¡ä¸Šå‚³è—¥å“è³‡æ–™ï¼Œå®Œæˆå¾Œå¯ä¸‹è¼‰æ–°çš„ data.json ä¸Šå‚³è‡³ GitHub Pagesã€‚</p>

<h2>æ–°å¢è—¥å“</h2>
<div class="add-form">
  <label>åˆ†é¡ï¼š
    <select id="category">
      <option value="products">ä¸€èˆ¬è—¥å“</option>
      <option value="specialProducts">å£¯é™½ / é¿å­• / ç„¡å¥ä¿è—¥ç‰©</option>
      <option value="coldProducts">å†·å“</option>
    </select>
  </label><br><br>
  <input type="text" id="nhicode" placeholder="å¥ä¿ç¢¼">
  <input type="text" id="medname" placeholder="è—¥å“åç¨±">
  <input type="text" id="spec" placeholder="è¦æ ¼">
  <input type="number" id="price" placeholder="å„ªæƒ åƒ¹">
  <input type="text" id="stock" placeholder="åº«å­˜"><br><br>
  <button onclick="addProduct()">æ–°å¢</button>
</div>

<h2>ç·¨è¼¯è—¥å“è³‡æ–™</h2>
<div id="tablesContainer"></div>

<div class="upload-section">
  <h3>æ‰¹æ¬¡ä¸Šå‚³ CSV</h3>
  <input type="file" id="fileInput" accept=".csv">
  <button onclick="importCSV()">åŒ¯å…¥</button>
  <p>ğŸ“¥ <a href="sample_utf8_bom.csv" download>ä¸‹è¼‰ç¯„ä¾‹æª”æ¡ˆ</a></p>
</div>

<button class="download-btn" onclick="downloadJSON()">â¬‡ï¸ ä¸‹è¼‰æ›´æ–°å¾Œ data.json</button>

<script>
let data = { products: [], specialProducts: [], coldProducts: [] };

// è®€å–ç¾æœ‰ JSON
fetch('data.json')
  .then(response => response.json())
  .then(json => { data = json; renderTables(); })
  .catch(err => { console.error('è®€å–å¤±æ•—', err); });

function renderTables() {
  const container = document.getElementById('tablesContainer');
  container.innerHTML = '';
  const categories = [
    {key:'products', label:'ä¸€èˆ¬è—¥å“'},
    {key:'specialProducts', label:'å£¯é™½ / é¿å­• / ç„¡å¥ä¿è—¥ç‰©'},
    {key:'coldProducts', label:'å†·å“'}
  ];
  categories.forEach(cat => {
    let html = `<h3>${cat.label}</h3><table><thead><tr>
      <th>å¥ä¿ç¢¼</th><th>è—¥å“åç¨±</th><th>è¦æ ¼</th><th>å„ªæƒ åƒ¹</th><th>åº«å­˜</th><th>åˆªé™¤</th>
      </tr></thead><tbody>`;
    data[cat.key].forEach((p,i) => {
      html += `<tr>
        <td contenteditable oninput="editField('${cat.key}',${i},'nhicode',this.innerText)">${p.nhicode}</td>
        <td contenteditable oninput="editField('${cat.key}',${i},'medname',this.innerText)">${p.medname}</td>
        <td contenteditable oninput="editField('${cat.key}',${i},'spec',this.innerText)">${p.spec}</td>
        <td contenteditable oninput="editField('${cat.key}',${i},'price',this.innerText)">${p.price}</td>
        <td contenteditable oninput="editField('${cat.key}',${i},'stock',this.innerText)">${p.stock}</td>
        <td><button onclick="deleteProduct('${cat.key}',${i})">åˆªé™¤</button></td>
      </tr>`;
    });
    html += '</tbody></table>';
    container.innerHTML += html;
  });
}

function addProduct() {
  const cat = document.getElementById('category').value;
  const obj = {
    nhicode: document.getElementById('nhicode').value,
    medname: document.getElementById('medname').value,
    spec: document.getElementById('spec').value,
    price: parseFloat(document.getElementById('price').value)||0,
    stock: document.getElementById('stock').value
  };
  if(obj.nhicode && obj.medname){
    data[cat].push(obj);
    renderTables();
    document.getElementById('nhicode').value='';
    document.getElementById('medname').value='';
    document.getElementById('spec').value='';
    document.getElementById('price').value='';
    document.getElementById('stock').value='';
  }
}

function editField(cat,i,field,value){
  data[cat][i][field] = (field==='price')?parseFloat(value)||0:value;
}

function deleteProduct(cat,i){
  if(confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é …ç›®å—?')){
    data[cat].splice(i,1);
    renderTables();
  }
}

function importCSV() {
  const file = document.getElementById('fileInput').files[0];
  const category = document.getElementById('category').value;
  if (!file) return alert('è«‹é¸æ“‡ CSV æª”æ¡ˆ');

  const reader = new FileReader();
  reader.onload = function(e) {
    const lines = e.target.result.split('\n').slice(1); // å»é™¤æ¨™é¡Œ
    lines.forEach(line => {
      const cols = line.split(',');
      if (cols.length >= 5) {
        data[category].push({
          nhicode: cols[0].trim(),
          medname: cols[1].trim(),
          spec: cols[2].trim(),
          price: parseFloat(cols[3])||0,
          stock: cols[4].trim()
        });
      }
    });
    renderTables();
    alert('æ‰¹æ¬¡ä¸Šå‚³å®Œæˆï¼');
  };
  reader.readAsText(file, 'utf-8');
}

function downloadJSON(){
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data.json';
  a.click();
  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
